1 REM nexus.bas
2 REM move to a corner and scan and shoot

10 LET SPEEDHIGH = 100
11 LET SPEEDMID = 50
12 LET SPEEDLOW = 10
13 LET SPEEDSTOP = 0


100 LET Q = RND 4
105 IF Q = 0 THEN GOTO 200
110 IF Q = 1 THEN GOTO 220
115 IF Q = 2 THEN GOTO 240
120 IF Q = 3 THEN GOTO 260
130 GOTO 240

200 LET DX = 100
205 LET DY = 100
210 GOTO 400

220 LET DX = 900
225 LET DY = 100
230 GOTO 400

240 LET DX = 900
245 LET DY = 900
250 GOTO 400

260 LET DX = 100
265 LET DY = 900
270 GOTO 400


400 GOSUB 2000
410 IF D > 50 THEN GOTO 400
420 GOTO 100




2000 REM drive to around DX,DY
2003 GOSUB 2110 : REM get angle to target
2004 DRIVE A,SPEEDHIGH
2005 GOSUB 5000 : REM get distance to target
2010 IF D < 50 THEN GOTO 2030
2015 IF D < 125 THEN GOTO 2040
2020 IF D >= 125 THEN GOTO 2005
2030 DRIVE A,SPEEDSTOP
2031 GOSUB 3010
2035 RETURN
2040 DRIVE A, SPEEDLOW
2045 GOTO 2005


2100 REM get angle to target
2110 LET LX = LOCX
2115 LET LY = LOCY
2120 LET A = ATN2 DY-LY, DX-LX
2125 RETURN

3000 REM scan and shoot 
3001 REM full 360
3010 LET SCANANGLE = 0
3020 LET RANGE = SCAN SCANANGLE, 5
3025 IF RANGE < 700 AND RANGE > 40 THEN GOTO 3050
3030 LET SCANANGLE = SCANANGLE + 10
3035 IF SCANANGLE = 360 THEN RETURN
3050 CANNON SCANANGLE, RANGE
3055 GOTO 3020

5000 REM calculate distance 
5001 REM DX,DY is the destination
5002 REM D is the distance
5005 LET LX = LOCX
5010 LET LY = LOCY
5015 LET TX = DX-LX
5020 LET TY = DY-LY
5025 LET D = SQR (TX*TX)+(TY*TY)
5030 RETURN